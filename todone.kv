#:import AsyncImage kivy.uix.image.AsyncImage
#:import Task taskfunctions.Task
#:import Factory kivy.factory.Factory

<Space@Label>:

<BG@FloatLayout>:
	canvas.before:
		Color:
			rgba: 0.176, 0.243, 0.314, 1.0
		Rectangle:
			pos: self.pos
			size: self.size

<TodoInput@TextInput>:
	background_normal:'data/images/src/textinput.png'
	background_active:'data/images/src/textinput_active.png'
	background_disabled_normal:'data/images/src/textinput_disabled.png'
	background_disabled_active:'data/images/src/textinput_disabled.png'
	font_name: 'data/fonts/Lato-Regular.ttf'
	font_size: '20sp'
	cursor_color: 0.498, 0.549, 0.552,1.0
	foreground_color: 0.204, 0.286, 0.369, 1.0
	selection_color: 0.925, 0.941, 0.937, 0.5
	padding: '8dp', '8dp'
	border: 10, 10, 10, 10
	height: self.minimum_height
	write_tab: False

<TodoButton@Button>:
	font_name: 'data/fonts/Lato-Bold.ttf'
	font_size: '22sp'
	padding: '8dp','8dp'
	border: 10,10,10,10
	background_normal:'data/images/src/but_turq.png'
	background_down: 'data/images/src/but_turq_down.png'
	background_disabled_normal:'data/images/src/but_disabled.png'
	background_disabled_down:'data/images/src/but_disabled.png'

<CompleteButton@TodoButton>

<TodoSpinnerOption@SpinnerOption>:
	font_name: 'data/fonts/Lato-Bold.ttf'
	padding: '8dp','8dp'
	background_normal:'data/images/src/but_blue.png'
	background_disabled_normal:'data/images/src/but_disabled.png'
	background_disabled_down:'data/images/src/but_disabled.png'

<TodoSpinner@Spinner>:
	font_name: 'data/fonts/Lato-Bold.ttf'
	font_size: '22sp'
	padding: '8dp','8dp'
	center: 0.5, 0.5
	background_normal:'data/images/src/but_turq.png'
	option_cls: Factory.get("TodoSpinnerOption")
	sync_height: True

<TodoLabel@Label>:
	size_hint_x: None
	width: self.texture_size[0]
	font_size: '20sp'
	color: 0.404, 0.522, 0.549, 1.0
	font_name: 'data/fonts/Lato-Heavy.ttf'

<SearchBox@BoxLayout>:
	padding:'8dp','8dp'
	orientation:'horizontal'
	spacing:'8dp'
	canvas.before:
		Color:
			rgba: 0.3,0.6,0.1, 1
		Rectangle:
			pos: self.pos
			size: self.size
	TextInput:
		hint_text:'Search'
		font_name: 'data/fonts/Lato-Regular.ttf'
		font_size: '18sp'
		background_color:(0,0,0,0)
		multiline:False
	Image:
		size_hint:None, None
		size:'32dp','32dp'
		source:'data/images/src/search.png'

<TaskWidget>:
	id: task_w
	orientation: 'vertical'
	but_del:but_del
	task_input:task_input
	pos_hint: 'center_x'
	size_hint_x: 0.98
	size_hint_y: None
	height: '110dp' if self.edit else '60dp'
	padding: 4
	spacing: '8dp'
	canvas:
		Color:
			rgba: 0.925, 0.941, 0.937, 1.0
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: 10,10,10,10
	BoxLayout:
		id: task_top
		orientation: 'horizontal'
		TodoInput:
			id: task_input
			multiline: False
			text: 'Default text box values'
			text_size: self.size
			size_hint_x: 1
			size_hint_min_x: 100
			text_size: (self.width, None)
			size_hint_y: 0.9
			pos_hint: {'left': 1}
		TodoLabel:
			id: lbl_freq
			text: root.ids['freq_spin'].text
			size_hint_x: 0.25
			size_hint_min_x: self.texture_size[0]*1.1
			size_hint_max_x: 200
			size_hint_y: 1
			height: self.texture_size[1]
			pos_hint: {'right': 0.4}
		TodoLabel:
			id: lbl_group
			text: root.ids['group_spin'].text
			size_hint_x: 0.25
			size_hint_min_x: self.texture_size[0]*1.1
			size_hint_max_x: 200
			size_hint_y: 1
			height: self.texture_size[1]
			pos_hint: {'right': 0.7}
		TodoButton:
			id: btn_complete
			text: 'Complete'
#			canvas:
#                RoundedRectangle:
#                    radius: 10,10,10,10
			size_hint_x: 0.25
			size_hint_min_x: 115
			size_hint_max_x: 140
		    text_size: self.width, None
		    width: self.texture_size[0]*1.2
#			background_normal: ''
#			background_color: (0.24, 0.84, 0.548, 1)
			on_release:root.dispatch('on_complete')
			pos_hint: {'right': 1}
	BoxLayout:
		id: task_btm
		orientation: 'horizontal'
		spacing:'16dp'
		TodoSpinner:
			id: freq_spin
			text: 'Once'
			on_text: root.frequency_changed()
			values: Task.frequency_list
			size_hint_x: 0.75
			size_hint_y: 0.9
		TodoSpinner:
			id: group_spin
			text: 'None'
			values: root.group_list
			size_hint_x: 0.75
			size_hint_y: 0.9
			sync_height: True
		Space:
			id: edit_spc
			size_hint_x: 1
			size_hint_y: 1
		TodoButton:
			id: but_del
			size_hint: None, None
			pos_hint: {'right': 1}
			size: '36dp', '36dp'
			border:8,8,8,8
			background_normal:'data/images/src/but_del.png'
			background_down:'data/images/src/but_del_down.png'
			on_release:root.dispatch('on_delete')

<TaskWidgetContainer@ScrollView>:
	GridLayout:
		id:container
		size_hint_y:None
		size_hint_x:1
		height:self.minimum_height
#		orientation:'lr-tb'
        cols: 1
		padding:'16dp','0dp','16dp','16dp'
		spacing:'16dp'
<ManageGroupPopup@Popup>:
	size_hint: 0.8, 0.8
	title: 'Group Manager'
	separator_height: 0
	BoxLayout:
		orientation: 'vertical'
		spacing: '12dp'
		TodoInput:
			id: new_grp_input
			hint_text: 'Type Group Name and Press Enter'
			multiline: False
			size_hint_y: None
			padding: '8dp'
			on_text_validate: root.dispatch('on_new_group')
		ScrollView:
		    GridLayout:
                id: container
                cols: 1

<GroupWidget@BoxLayout>:
    id: group_w
    orientation: 'horizontal'
    but_del:but_del
    size_hint_y: None
    height: '44dp'
    canvas:
        Color:
            rgba: 0.925, 0.941, 0.937, 1.0
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: 4,4,4,4
    TodoInput:
        id: grp_input
        size_hint: 0.9, None
        center_y: .5
        text: root.group
        multiline: False
        on_focus: root.dispatch('on_change_focus')
    TodoButton:
        id: but_del
        size_hint: None, None
        pos_hint: {'right': 1}
        size: '36dp', '36dp'
        border:8,8,8,8
        background_normal:'data/images/src/but_del.png'
        background_down:'data/images/src/but_del_down.png'
        on_release:root.dispatch('on_delete_group')

<TopBar@BoxLayout>:
	orientation:'horizontal'
	spacing:'16dp'
	TodoButton:
		size_hint:None, None
		size:'48dp', '48dp'
		border:10,10,10,10
		background_normal:'data/images/src/but_new.png'
		background_down:'data/images/src/but_new_down.png'
		on_release: root.dispatch('on_add_taskwidget')
	Space:
#    SearchBox:
#        width:'240dp'
#        size_hint_x:None
    TodoButton:
        size_hint:None, None
        height: '48dp'
        text:'Manage Groups'
        width: self.texture_size[0]*1.2
        background_normal:'data/images/src/but_blue.png'
        background_down:'data/images/src/but_blue_down.png'
        on_release:root.dispatch('on_manage_groups')

<TaskScreen>:
	BG:
		BoxLayout:
			orientation:'vertical'
			TopBar:
				size_hint_y: None
				height:'64dp'
				padding:'16dp','16dp','16dp','0dp'
				on_add_taskwidget: root.new_task()
				on_manage_groups: root.manage_groups_popup()
			Space:
				size_hint_y:None
				height:'16dp'
			TaskWidgetContainer:
				id: task_container
